<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D System Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@react-three/fiber@8.15.19/dist/index.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@react-three/drei@9.105.6/dist/index.umd.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <style>
        body { margin: 0; font-family: Arial, sans-serif; background: #111; color: white; }
        .container { display: flex; height: 100vh; }
        .panel { flex: 1; padding: 20px; border-right: 1px solid #333; }
        .viewer { flex: 1; background: #222; }
        button { background: #444; color: white; border: none; padding: 10px 20px; margin: 5px; border-radius: 5px; cursor: pointer; }
        button:hover { background: #555; }
        .status { margin-top: 20px; padding: 10px; background: #333; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="panel">
            <h2>3D System Test</h2>
            <button onclick="testBasicRendering()">Test Basic 3D Rendering</button>
            <button onclick="testModelLoading()">Test Model Loading</button>
            <button onclick="testTripo3DAPI()">Test Tripo3D API</button>
            <div class="status" id="status">Ready to test...</div>
        </div>
        <div class="viewer" id="viewer"></div>
    </div>

    <script>
        let scene, camera, renderer, cube;

        function initThreeJS() {
            // Create scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x222222);

            // Create camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / 2 / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;

            // Create renderer
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth / 2, window.innerHeight);
            document.getElementById('viewer').appendChild(renderer.domElement);

            // Add lighting
            const ambientLight = new THREE.AmbientLight(0x404040);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
            directionalLight.position.set(1, 1, 1);
            scene.add(directionalLight);

            // Add orbit controls
            const controls = new THREE.OrbitControls(camera, renderer.domElement);

            // Animation loop
            function animate() {
                requestAnimationFrame(animate);
                controls.update();
                renderer.render(scene, camera);
            }
            animate();

            updateStatus('Three.js initialized successfully');
        }

        function testBasicRendering() {
            if (!scene) initThreeJS();

            // Remove existing cube if it exists
            if (cube) scene.remove(cube);

            // Create a cube
            const geometry = new THREE.BoxGeometry(1, 1, 1);
            const material = new THREE.MeshLambertMaterial({ color: 0x00ff00 });
            cube = new THREE.Mesh(geometry, material);
            scene.add(cube);

            updateStatus('Basic 3D cube rendered successfully');
        }

        function testModelLoading() {
            updateStatus('Model loading test - would load GLTF/GLB model here');
            // In a real test, we would load a model from a URL
            // For now, just show that the function is called
        }

        async function testTripo3DAPI() {
            updateStatus('Testing Tripo3D API...');

            try {
                // Test the Tripo3D API (this would normally be called from the backend)
                const response = await fetch('https://api.tripo3d.ai/v2/openapi/task', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer tsk_o6tbxmsseUFCqekAUjrzVTzMGe2sb0ZRnqE9QBhJF4-'
                    },
                    body: JSON.stringify({
                        "type": "image_to_3d",
                        "file": {
                            "type": "url",
                            "url": "https://example.com/test-image.jpg"
                        }
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    updateStatus(`Tripo3D API responded: ${JSON.stringify(data, null, 2)}`);
                } else {
                    updateStatus(`Tripo3D API error: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                updateStatus(`Tripo3D API failed: ${error.message}`);
            }
        }

        function updateStatus(message) {
            document.getElementById('status').textContent = message;
            console.log(message);
        }

        // Initialize on load
        window.onload = () => {
            updateStatus('Page loaded. Click buttons to test 3D functionality.');
        };
    </script>
</body>
</html>