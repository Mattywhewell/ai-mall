const fs = require('fs');
const imgPath = 'ci-artifacts/run-20993629602/user-journeys-da5c7/resources/page@9992e5136f787163020e7f29a577cf55-1768392944213.jpeg';
const b = fs.readFileSync(imgPath).toString('base64');
const body = [];
body.push('CI artifacts are available for PR #8 — I downloaded the Playwright artifacts from run 20993629602 and extracted traces for failing tests. Below is a representative screenshot from the user-journeys trace showing the page state at failure.');
body.push('');
body.push('**Screenshot (Wander Path - district navigation failure)**');
body.push('');
body.push('![Wander Path CI screenshot](data:image/jpeg;base64,' + b + ')');
body.push('');
body.push('**What I downloaded (representative):**');
body.push('- ci-artifacts/run-20993629602/playwright-artifacts/test-results/user-journeys-User-Journey-da5c7-m-home-to-city-to-districts-chromium/trace.zip');
body.push('- ci-artifacts/run-20993629602/playwright-artifacts/test-results/account-loggedin-Account-d-141a8-ign-out-dev-test-user-true--chromium/trace.zip');
body.push('- ci-artifacts/run-20993629602/playwright-artifacts/test-results/* (many traces + error-context.md files for failing tests)');
body.push('');
body.push('**Initial triage (high level):**');
body.push('- **Failing tests (examples):** account-loggedin, channel-connections, images, inventory-sync, order-sync, price-sync, product-mappings, several RBAC tests, and user-journeys (Wander Path).');
body.push("- **Common signals:** multiple locator.waitFor/Timeout errors (missing elements), several API-retry UI tests did not show 'Retry' buttons, and image/hero assets sometimes missing. Hydration mismatch warnings appear in browser console in multiple traces.");
body.push('- **User-Journey specifics:** district link not found on /city so test fell back to /districts index and found 0 entries (trace extracted).');
body.push("- **Account menu:** 'Could not open account menu: no clickable element found' — trace contains DOM snapshot and error-context.md.");
body.push('');
body.push('**Next steps I suggest:**');
body.push('1. I will dig into the user-journeys and account traces first and capture specific DOM snapshots and console logs showing why the expected elements are missing.');
body.push('2. If these are timing/hydration issues, we should consider small test hardening (increase waits / add retries / mark flaky assertions) in a follow-up PR and re-run.');
body.push('3. If traces suggest missing seeded data in the CI environment, we should add a short seeding step in the workflow or ensure test fixtures are set before the Playwright run.');
body.push('');
body.push('I\'m starting a focused triage now on the **user-journeys** and **account-loggedin** traces and will report findings and recommended fixes next. If you want me to attach any of the full trace.zip files to the PR or open a follow-up PR with targeted test fixes immediately, tell me which and I\'ll proceed.');

fs.writeFileSync('tmp-pr-comment3.md', body.join('\n'));
console.log('Wrote tmp-pr-comment3.md');
