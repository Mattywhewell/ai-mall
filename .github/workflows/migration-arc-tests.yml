name: Migration Arc - Idempotence Tests

on:
  pull_request:
    paths:
      - 'scripts/migration-arc/**'
      - 'docs/migration-arc.md'

jobs:
  idempotence:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install OpenSSH (ensure ssh-keygen present)
        run: sudo apt-get update && sudo apt-get install -y openssh-client
      - name: Run migration-arc idempotence smoke test
        run: bash ./scripts/migration-arc/tests/test_idempotence.sh
      - name: Run migration-arc cert flow test
        run: bash ./scripts/migration-arc/tests/test_cert_flow.sh
      - name: Run authorized principals (revocation) test
        run: bash ./scripts/migration-arc/tests/test_authorized_principals.sh
      - name: Run authorized principals parsing-variant tests
        run: bash ./scripts/migration-arc/tests/test_authorized_principals_parsing.sh
      - name: Run simulated sshd integration test
        run: bash ./scripts/migration-arc/tests/test_sshd_simulated.sh
